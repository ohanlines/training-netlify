<!DOCTYPE html>
<html>
    <head>
        <title>My Counter</title>
        <script type="text/javascript" src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
        <script src="https://unpkg.com/netlify-identity-widget@2/build/netlify-identity-widget.min.js"></script>
    </head>
    <body>
        <h1>My Counter</h1>

        <!-- Add a menu:
          Log in / Sign up - when the user is not logged in
          Username / Log out - when the user is logged in
        -->
        <div data-netlify-identity-menu></div>

        <!-- Add a simpler button:
             Simple button that will open the modal.
        -->
        <div data-netlify-identity-button>Login with Netlify Identity</div>

        <!-- button testing -->
        <button id="fetch-btn">Fetch</button>
        <button id="poke-btn">Fetch POKE_API</button>
        <p id="output-btn">Initial p tag</p>

        <form>
          <label for="counter">Counter:</label><br />
          <input type="text" id="counter" value="0" /><br />
          <button type="button" onclick="incrementCounter()">Increment</button>
        </form>

        <script>
          // === button testing script ===
          document.addEventListener('DOMContentLoaded', () => {
              
              const fetchBtn = document.getElementById('fetch-btn')
              const pokeBtn = document.getElementById('poke-btn')
              const outputTxt = document.getElementById('output-btn')

              pokeBtn.addEventListener('click', async () => {
                  const response = await fetch('/.netlify/functions/pokedex').then(response => response.json())

                  outputTxt.innerText = JSON.stringify(response)
              })
              fetchBtn.addEventListener('click', async () => {
                  const response = await fetch('/.netlify/functions/hello').then(response => response.json())

                  outputTxt.innerText = JSON.stringify(response)
              })
          })
          
          // === Increment Function ===
          function incrementCounter() {
              // Get the current value of the counter input field
              var counter = document.getElementById("counter");
              var value = parseInt(counter.value);

              // Make a POST request to the /increment endpoint
              fetch(".netlify/functions/increment", {
                  method: "POST",
                  body: JSON.stringify({ value: value }),
              })
                  .then(function (response) {
                      return response.json();
                  })
                  .then(function (data) {
                      // Update the value of the counter input field with the new value
                      counter.value = data.value;
                  })
                  .catch(function (error) {
                      console.error("Error:", error);
                  });
          }
    </script>
    </body>
</html>
